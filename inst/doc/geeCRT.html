<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Hengshi Yu, Fan Li, Paul Rathouz, Elizabeth L. Turner, John Preisser" />

<meta name="date" content="2021-04-14" />

<title>geeCRT package</title>

<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">geeCRT package</h1>
<h4 class="author">Hengshi Yu, Fan Li, Paul Rathouz, Elizabeth L. Turner, John Preisser</h4>
<h4 class="date">2021-04-14</h4>



<div id="overview" class="section level2">
<h2>Overview</h2>
<p>geeCRT is an R package for implementing the bias-corrected generalized estimating equations in analyzing cluster randomized trials.</p>
<p>Population-averaged models have been increasingly used in the design and analysis of cluster randomized trials (CRTs). To facilitate the applications of population-averaged models in CRTs, we implement the generalized estimating equations (GEE) and matrix-adjusted estimating equations (MAEE) approaches to jointly estimate the marginal mean models correlation models both for general CRTs and stepped wedge CRTs.</p>
<p>Despite the general GEE/MAEE approach, we also implement a fast cluster-period GEE method specifically for stepped wedge CRTs with large and variable cluster-period sizes. The individual-level GEE/MAEE approach becomes computationally infeasible in this setting due to inversion of high-dimensional covariance matrices and the enumeration of a high-dimensional design matrix for the correlation estimation equations. The package gives a simple and efficient estimating equations approach based on the cluster-period means to estimate the intervention effects as well as correlation parameters.</p>
<p>In addition, the package also provides functions for generating correlated binary data with specific mean vector and correlation matrix based on the multivariate probit method <span class="citation">(Emrich and Piedmonte 1991)</span> or the conditional linear family method <span class="citation">(Qaqish 2003)</span>. These two functions facilitate generating correlated binary data in future simulation studies.</p>
</div>
<div id="geemaee-example-matrix-adjusted-gee-for-estimating-the-mean-and-correlation-parameters-in-crts" class="section level2">
<h2><code>geemaee()</code> example: matrix-adjusted GEE for estimating the mean and correlation parameters in CRTs</h2>
<p>The <code>geemaee()</code> function implements the matrix-adjusted GEE or regular GEE developed for analyzing cluster randomized trials (CRTs). It provides valid estimation and inference for the treatment effect and intraclass correlation parameters within the population-averaged modeling framework. The program allows for flexible marginal mean model specifications. The program also offers bias-corrected intraclass correlation coefficient (ICC) estimates as well as bias-corrected sandwich variances for both the treatment effect parameter and the ICC parameters. The technical details of the matrix-adjusted GEE approach are provided in <span class="citation">(Preisser, Lu, and Qaqish 2008)</span> and <span class="citation">(Li, Turner, and Preisser 2018)</span>.</p>
<p>For the individual-level data, we use the <code>geemaee()</code> function to estimate the marginal mean and correlation parameters in CRTs. We use two simulated stepped wedge CRT datasets with true nested exchangeable correlation structure to illustrate the <code>geemaee()</code> function examples.</p>
<div id="simulated-dataset-with-12-clusters-and-4-periods." class="section level3">
<h3>Simulated dataset with 12 clusters and 4 periods.</h3>
<table>
<thead>
<tr class="header">
<th align="right">period1</th>
<th align="right">period2</th>
<th align="right">period3</th>
<th align="right">period4</th>
<th align="right">treatment</th>
<th align="right">id</th>
<th align="right">period</th>
<th align="right">y_bin</th>
<th align="right">y_con</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">-0.5728721</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1.0462372</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.6033255</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">-0.8680703</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">-1.8845704</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">-0.5572751</td>
</tr>
</tbody>
</table>
<p>We first create an auxiliary function <code>createzCrossSec()</code> to help create the design matrix for the estimating equations of the correlation parameters. We then collect design matrix <code>X</code> for the mean parameters with five period indicators and the treatment indicator.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>createzCrossSec =<span class="st"> </span><span class="cf">function</span> (m) {</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a>    Z =<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>    n =<span class="st"> </span><span class="kw">dim</span>(m)[<span class="dv">1</span>]</span>
<span id="cb1-5"><a href="#cb1-5"></a>    </span>
<span id="cb1-6"><a href="#cb1-6"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n) {</span>
<span id="cb1-7"><a href="#cb1-7"></a>        </span>
<span id="cb1-8"><a href="#cb1-8"></a>        alpha_<span class="dv">0</span> =<span class="st"> </span><span class="dv">1</span>; alpha_<span class="dv">1</span> =<span class="st"> </span><span class="dv">2</span>; n_i =<span class="st"> </span><span class="kw">c</span>(m[i, ]); n_length =<span class="st"> </span><span class="kw">length</span>(n_i)</span>
<span id="cb1-9"><a href="#cb1-9"></a>        POS =<span class="st"> </span><span class="kw">matrix</span>(alpha_<span class="dv">1</span>, <span class="kw">sum</span>(n_i), <span class="kw">sum</span>(n_i))</span>
<span id="cb1-10"><a href="#cb1-10"></a>        loc1 =<span class="st"> </span><span class="dv">0</span>; loc2 =<span class="st"> </span><span class="dv">0</span></span>
<span id="cb1-11"><a href="#cb1-11"></a>        </span>
<span id="cb1-12"><a href="#cb1-12"></a>        <span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n_length) {</span>
<span id="cb1-13"><a href="#cb1-13"></a>            </span>
<span id="cb1-14"><a href="#cb1-14"></a>            n_t =<span class="st"> </span>n_i[s]; loc1 =<span class="st"> </span>loc2 <span class="op">+</span><span class="st"> </span><span class="dv">1</span>; loc2 =<span class="st"> </span>loc1 <span class="op">+</span><span class="st"> </span>n_t <span class="op">-</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb1-15"><a href="#cb1-15"></a>            </span>
<span id="cb1-16"><a href="#cb1-16"></a>            <span class="cf">for</span> (k <span class="cf">in</span> loc1<span class="op">:</span>loc2) {</span>
<span id="cb1-17"><a href="#cb1-17"></a></span>
<span id="cb1-18"><a href="#cb1-18"></a>                <span class="cf">for</span> (j <span class="cf">in</span> loc1<span class="op">:</span>loc2) {</span>
<span id="cb1-19"><a href="#cb1-19"></a></span>
<span id="cb1-20"><a href="#cb1-20"></a>                    <span class="cf">if</span> (k <span class="op">!=</span><span class="st"> </span>j) { POS[k, j] =<span class="st"> </span>alpha_<span class="dv">0</span> } <span class="cf">else</span> { POS[k, j] =<span class="st"> </span><span class="dv">0</span> }}}}</span>
<span id="cb1-21"><a href="#cb1-21"></a></span>
<span id="cb1-22"><a href="#cb1-22"></a>        zrow =<span class="st"> </span><span class="kw">diag</span>(<span class="dv">2</span>); z_c =<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb1-23"><a href="#cb1-23"></a>        </span>
<span id="cb1-24"><a href="#cb1-24"></a>        <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(<span class="kw">sum</span>(n_i) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)) { </span>
<span id="cb1-25"><a href="#cb1-25"></a></span>
<span id="cb1-26"><a href="#cb1-26"></a>            <span class="cf">for</span> (k <span class="cf">in</span> (j <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)<span class="op">:</span><span class="kw">sum</span>(n_i)) {z_c =<span class="st"> </span><span class="kw">rbind</span>(z_c, zrow[POS[j,k],])}}</span>
<span id="cb1-27"><a href="#cb1-27"></a>        </span>
<span id="cb1-28"><a href="#cb1-28"></a>        Z =<span class="st"> </span><span class="kw">rbind</span>(Z, z_c) }</span>
<span id="cb1-29"><a href="#cb1-29"></a></span>
<span id="cb1-30"><a href="#cb1-30"></a>    <span class="kw">return</span>(Z)}</span></code></pre></div>
<p>We implement the <code>geemaee()</code> function on both the continuous outcome and binary outcome, and consider both matrix-adjusted estimating equations (MAEE) with <code>alpadj = TRUE</code> and uncorrected generalized estimating equations (GEE) with <code>alpadj = FALSE</code>. For the <code>shrink</code> argument, we use the <code>&quot;ALPHA&quot;</code> method to tune step sizes and focus on using estimated variances in the correlation estimating equations rather than using unit variances by specifying <code>makevone = FALSE</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>sampleSWCRT =<span class="st"> </span>sampleSWCRTSmall</span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co">### Individual-level id, period, outcome, and design matrix</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>id =<span class="st"> </span>sampleSWCRT<span class="op">$</span>id; period =<span class="st"> </span>sampleSWCRT<span class="op">$</span>period;</span>
<span id="cb2-5"><a href="#cb2-5"></a>X =<span class="st"> </span><span class="kw">as.matrix</span>(sampleSWCRT[, <span class="kw">c</span>(<span class="st">&#39;period1&#39;</span>, <span class="st">&#39;period2&#39;</span>, <span class="st">&#39;period3&#39;</span>, <span class="st">&#39;period4&#39;</span>, <span class="st">&#39;treatment&#39;</span>)])</span>
<span id="cb2-6"><a href="#cb2-6"></a>m =<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">table</span>(id, period)); n =<span class="st"> </span><span class="kw">dim</span>(m)[<span class="dv">1</span>]; t =<span class="st"> </span><span class="kw">dim</span>(m)[<span class="dv">2</span>]</span>
<span id="cb2-7"><a href="#cb2-7"></a></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co">### design matrix for correlation parameters</span></span>
<span id="cb2-9"><a href="#cb2-9"></a>Z =<span class="st"> </span><span class="kw">createzCrossSec</span>(m) </span>
<span id="cb2-10"><a href="#cb2-10"></a></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co">### (1) Matrix-adjusted estimating equations and GEE </span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="co">### on continous outcome with nested exchangeable correlation structure</span></span>
<span id="cb2-13"><a href="#cb2-13"></a> </span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="co">### MAEE</span></span>
<span id="cb2-15"><a href="#cb2-15"></a>est_maee_ind_con =<span class="st"> </span><span class="kw">geemaee</span>(<span class="dt">y =</span> sampleSWCRT<span class="op">$</span>y_con, </span>
<span id="cb2-16"><a href="#cb2-16"></a>                           <span class="dt">X =</span> X, <span class="dt">id  =</span> id, <span class="dt">Z =</span> Z, </span>
<span id="cb2-17"><a href="#cb2-17"></a>                           <span class="dt">family =</span> <span class="st">&quot;continuous&quot;</span>, </span>
<span id="cb2-18"><a href="#cb2-18"></a>                           <span class="dt">maxiter =</span> <span class="dv">500</span>, <span class="dt">epsilon =</span> <span class="fl">0.001</span>, </span>
<span id="cb2-19"><a href="#cb2-19"></a>                           <span class="dt">printrange =</span> <span class="ot">TRUE</span>, <span class="dt">alpadj =</span> <span class="ot">TRUE</span>, </span>
<span id="cb2-20"><a href="#cb2-20"></a>                           <span class="dt">shrink =</span> <span class="st">&quot;ALPHA&quot;</span>, <span class="dt">makevone =</span> <span class="ot">FALSE</span>)</span>
<span id="cb2-21"><a href="#cb2-21"></a></span>
<span id="cb2-22"><a href="#cb2-22"></a><span class="co">### GEE</span></span>
<span id="cb2-23"><a href="#cb2-23"></a>est_uee_ind_con =<span class="st"> </span><span class="kw">geemaee</span>(<span class="dt">y =</span> sampleSWCRT<span class="op">$</span>y_con, </span>
<span id="cb2-24"><a href="#cb2-24"></a>                          <span class="dt">X =</span> X, <span class="dt">id =</span> id, <span class="dt">Z =</span> Z, </span>
<span id="cb2-25"><a href="#cb2-25"></a>                          <span class="dt">family =</span> <span class="st">&quot;continuous&quot;</span>, </span>
<span id="cb2-26"><a href="#cb2-26"></a>                          <span class="dt">maxiter =</span> <span class="dv">500</span>, <span class="dt">epsilon =</span> <span class="fl">0.001</span>, </span>
<span id="cb2-27"><a href="#cb2-27"></a>                          <span class="dt">printrange =</span> <span class="ot">TRUE</span>, <span class="dt">alpadj =</span> <span class="ot">FALSE</span>, </span>
<span id="cb2-28"><a href="#cb2-28"></a>                          <span class="dt">shrink =</span> <span class="st">&quot;ALPHA&quot;</span>, <span class="dt">makevone =</span> <span class="ot">FALSE</span>)</span>
<span id="cb2-29"><a href="#cb2-29"></a></span>
<span id="cb2-30"><a href="#cb2-30"></a><span class="co">### (2) Matrix-adjusted estimating equations and GEE </span></span>
<span id="cb2-31"><a href="#cb2-31"></a><span class="co">### on binary outcome with nested exchangeable correlation structure</span></span>
<span id="cb2-32"><a href="#cb2-32"></a></span>
<span id="cb2-33"><a href="#cb2-33"></a><span class="co">### MAEE</span></span>
<span id="cb2-34"><a href="#cb2-34"></a>est_maee_ind_bin =<span class="st"> </span><span class="kw">geemaee</span>(<span class="dt">y =</span> sampleSWCRT<span class="op">$</span>y_bin, </span>
<span id="cb2-35"><a href="#cb2-35"></a>                           <span class="dt">X =</span> X, <span class="dt">id =</span> id, <span class="dt">Z =</span> Z, </span>
<span id="cb2-36"><a href="#cb2-36"></a>                           <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>, </span>
<span id="cb2-37"><a href="#cb2-37"></a>                           <span class="dt">maxiter =</span> <span class="dv">500</span>, <span class="dt">epsilon =</span> <span class="fl">0.001</span>, </span>
<span id="cb2-38"><a href="#cb2-38"></a>                           <span class="dt">printrange =</span> <span class="ot">TRUE</span>, <span class="dt">alpadj =</span> <span class="ot">TRUE</span>, </span>
<span id="cb2-39"><a href="#cb2-39"></a>                           <span class="dt">shrink =</span> <span class="st">&quot;ALPHA&quot;</span>, <span class="dt">makevone =</span> <span class="ot">FALSE</span>)</span>
<span id="cb2-40"><a href="#cb2-40"></a><span class="kw">print</span>(est_maee_ind_bin)</span></code></pre></div>
<pre><code>## GEE for correlated Gaussian data 
##  Number of Iterations: 7 
## Results for marginal mean parameters 
##      Beta   Estimate MB-stderr BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]    0 -0.7731496 0.2861811  0.2397046  0.2507701  0.2623524  0.2528516
## [2,]    1 -0.5067925 0.3163229  0.3125495  0.3364462  0.3626966  0.3340832
## [3,]    2 -0.6159656 0.4107850  0.5793391  0.6398733  0.7076154  0.6341025
## [4,]    3 -0.5932682 0.5956314  0.5498687  0.6043812  0.6650312  0.6087172
## [5,]    4 -0.9959081 0.4904630  0.5373051  0.5918909  0.6525862  0.5889413
## 
## Results for correlation parameters 
##      Alpha   Estimate BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]     0 0.09615638 0.03212815 0.03375024 0.03546144 0.03373575
## [2,]     1 0.03369215 0.03077853 0.03223000 0.03375486 0.03224127</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">### GEE</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>est_uee_ind_bin =<span class="st"> </span><span class="kw">geemaee</span>(<span class="dt">y =</span> sampleSWCRT<span class="op">$</span>y_bin, </span>
<span id="cb4-3"><a href="#cb4-3"></a>                          <span class="dt">X =</span> X, <span class="dt">id =</span> id, <span class="dt">Z =</span> Z, </span>
<span id="cb4-4"><a href="#cb4-4"></a>                          <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>, </span>
<span id="cb4-5"><a href="#cb4-5"></a>                          <span class="dt">maxiter =</span> <span class="dv">500</span>, <span class="dt">epsilon =</span> <span class="fl">0.001</span>, </span>
<span id="cb4-6"><a href="#cb4-6"></a>                          <span class="dt">printrange =</span> <span class="ot">TRUE</span>, <span class="dt">alpadj =</span> <span class="ot">FALSE</span>, </span>
<span id="cb4-7"><a href="#cb4-7"></a>                          <span class="dt">shrink =</span> <span class="st">&quot;ALPHA&quot;</span>, <span class="dt">makevone =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p>Then we have the following output:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a> <span class="co"># MAEE for continuous outcome</span></span>
<span id="cb5-2"><a href="#cb5-2"></a> <span class="kw">print</span>(est_maee_ind_con)</span></code></pre></div>
<pre><code>## GEE for correlated Gaussian data 
##  Number of Iterations: 6 
## Results for marginal mean parameters 
##      Beta   Estimate MB-stderr BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]    0  0.1563400 0.1233724 0.11343910  0.1185200  0.1238356  0.1185676
## [2,]    1  0.2598417 0.1396584 0.15564306  0.1665805  0.1783248  0.1655108
## [3,]    2  0.2750434 0.1744216 0.09769357  0.1056224  0.1143643  0.1037000
## [4,]    3  0.3265847 0.2269849 0.20527795  0.2202021  0.2363784  0.2191884
## [5,]    4 -0.1846654 0.1916254 0.14636555  0.1592412  0.1733169  0.1587060
## 
## Results for correlation parameters 
##      Alpha   Estimate BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]     0 0.07335831  0.0385460 0.04035981 0.04226387 0.04042324
## [2,]     1 0.03210581  0.0160329 0.01683282 0.01767569 0.01684501</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a> <span class="co"># GEE for continuous outcome</span></span>
<span id="cb7-2"><a href="#cb7-2"></a> <span class="kw">print</span>(est_uee_ind_con)</span></code></pre></div>
<pre><code>## GEE for correlated Gaussian data 
##  Number of Iterations: 4 
## Results for marginal mean parameters 
##      Beta   Estimate MB-stderr BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]    0  0.1558990 0.1174052 0.11335326  0.1184565  0.1237977  0.1185069
## [2,]    1  0.2600341 0.1331291 0.15660456  0.1676591  0.1795345  0.1666850
## [3,]    2  0.2744039 0.1658703 0.09732366  0.1052335  0.1139553  0.1035272
## [4,]    3  0.3294253 0.2163095 0.20723038  0.2223924  0.2388282  0.2219057
## [5,]    4 -0.1857484 0.1828737 0.14726062  0.1602631  0.1744810  0.1599123
## 
## Results for correlation parameters 
##      Alpha   Estimate BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]     0 0.05304519 0.03055184 0.03200002 0.03352079 0.03204680
## [2,]     1 0.03019984 0.01459571 0.01532844 0.01610073 0.01533637</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a> <span class="co"># MAEE for binary outcome</span></span>
<span id="cb9-2"><a href="#cb9-2"></a> <span class="kw">print</span>(est_maee_ind_bin)</span></code></pre></div>
<pre><code>## GEE for correlated Gaussian data 
##  Number of Iterations: 7 
## Results for marginal mean parameters 
##      Beta   Estimate MB-stderr BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]    0 -0.7731496 0.2861811  0.2397046  0.2507701  0.2623524  0.2528516
## [2,]    1 -0.5067925 0.3163229  0.3125495  0.3364462  0.3626966  0.3340832
## [3,]    2 -0.6159656 0.4107850  0.5793391  0.6398733  0.7076154  0.6341025
## [4,]    3 -0.5932682 0.5956314  0.5498687  0.6043812  0.6650312  0.6087172
## [5,]    4 -0.9959081 0.4904630  0.5373051  0.5918909  0.6525862  0.5889413
## 
## Results for correlation parameters 
##      Alpha   Estimate BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]     0 0.09615638 0.03212815 0.03375024 0.03546144 0.03373575
## [2,]     1 0.03369215 0.03077853 0.03223000 0.03375486 0.03224127</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a> <span class="co"># GEE for binary outcome</span></span>
<span id="cb11-2"><a href="#cb11-2"></a> <span class="kw">print</span>(est_uee_ind_bin)</span></code></pre></div>
<pre><code>## GEE for correlated Gaussian data 
##  Number of Iterations: 4 
## Results for marginal mean parameters 
##      Beta   Estimate MB-stderr BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]    0 -0.7716253 0.2693959  0.2404336  0.2516128  0.2633193  0.2537330
## [2,]    1 -0.5040824 0.2983658  0.3111895  0.3349180  0.3609889  0.3328046
## [3,]    2 -0.6329007 0.3872258  0.5796856  0.6406367  0.7089294  0.6350176
## [4,]    3 -0.5905097 0.5625779  0.5551809  0.6102428  0.6715582  0.6149354
## [5,]    4 -0.9942493 0.4649278  0.5404357  0.5954360  0.6566581  0.5926395
## 
## Results for correlation parameters 
##      Alpha   Estimate BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]     0 0.06909291 0.02771682 0.02909958 0.03055802 0.02908517
## [2,]     1 0.03017185 0.02749985 0.02879600 0.03015777 0.02880640</code></pre>
</div>
<div id="simulated-dataset-with-12-clusters-and-5-periods" class="section level3">
<h3>Simulated dataset with 12 clusters and 5 periods</h3>
<table>
<thead>
<tr class="header">
<th align="right">period1</th>
<th align="right">period2</th>
<th align="right">period3</th>
<th align="right">period4</th>
<th align="right">period5</th>
<th align="right">treatment</th>
<th align="right">id</th>
<th align="right">period</th>
<th align="right">y_bin</th>
<th align="right">y_con</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.6789756</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.3776961</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">-0.5519475</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">-1.3102658</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.2654200</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">-0.3327958</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co">########################################################################</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="co">### Example 2): simulated SW-CRT with larger cluster-period sizes (20~30)</span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="co">########################################################################</span></span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="co">## This will elapse longer. </span></span>
<span id="cb13-5"><a href="#cb13-5"></a>sampleSWCRT =<span class="st"> </span>sampleSWCRTLarge</span>
<span id="cb13-6"><a href="#cb13-6"></a></span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="co">### Individual-level id, period, outcome, and design matrix</span></span>
<span id="cb13-8"><a href="#cb13-8"></a>id =<span class="st"> </span>sampleSWCRT<span class="op">$</span>id; period =<span class="st">  </span>sampleSWCRT<span class="op">$</span>period;</span>
<span id="cb13-9"><a href="#cb13-9"></a>X =<span class="st"> </span><span class="kw">as.matrix</span>(sampleSWCRT[, <span class="kw">c</span>(<span class="st">&#39;period1&#39;</span>, <span class="st">&#39;period2&#39;</span>, <span class="st">&#39;period3&#39;</span>, <span class="st">&#39;period4&#39;</span>, <span class="st">&#39;period5&#39;</span>, <span class="st">&#39;treatment&#39;</span>)])</span>
<span id="cb13-10"><a href="#cb13-10"></a>m =<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">table</span>(id, period)); n =<span class="st"> </span><span class="kw">dim</span>(m)[<span class="dv">1</span>]; t =<span class="st"> </span><span class="kw">dim</span>(m)[<span class="dv">2</span>]</span>
<span id="cb13-11"><a href="#cb13-11"></a><span class="co">### design matrix for correlation parameters</span></span>
<span id="cb13-12"><a href="#cb13-12"></a>Z =<span class="st"> </span><span class="kw">createzCrossSec</span>(m) </span>
<span id="cb13-13"><a href="#cb13-13"></a></span>
<span id="cb13-14"><a href="#cb13-14"></a><span class="co">### (1) Matrix-adjusted estimating equations and GEE </span></span>
<span id="cb13-15"><a href="#cb13-15"></a><span class="co">### on continous outcome with nested exchangeable correlation structure</span></span>
<span id="cb13-16"><a href="#cb13-16"></a> </span>
<span id="cb13-17"><a href="#cb13-17"></a><span class="co">### MAEE</span></span>
<span id="cb13-18"><a href="#cb13-18"></a>est_maee_ind_con =<span class="st"> </span><span class="kw">geemaee</span>(<span class="dt">y =</span> sampleSWCRT<span class="op">$</span>y_con, </span>
<span id="cb13-19"><a href="#cb13-19"></a>                           <span class="dt">X =</span> X, <span class="dt">id  =</span> id, <span class="dt">Z =</span> Z, </span>
<span id="cb13-20"><a href="#cb13-20"></a>                           <span class="dt">family =</span> <span class="st">&quot;continuous&quot;</span>, </span>
<span id="cb13-21"><a href="#cb13-21"></a>                           <span class="dt">maxiter =</span> <span class="dv">500</span>, <span class="dt">epsilon =</span> <span class="fl">0.001</span>, </span>
<span id="cb13-22"><a href="#cb13-22"></a>                           <span class="dt">printrange =</span> <span class="ot">TRUE</span>, <span class="dt">alpadj =</span> <span class="ot">TRUE</span>, </span>
<span id="cb13-23"><a href="#cb13-23"></a>                           <span class="dt">shrink =</span> <span class="st">&quot;ALPHA&quot;</span>, <span class="dt">makevone =</span> <span class="ot">FALSE</span>)</span>
<span id="cb13-24"><a href="#cb13-24"></a><span class="kw">print</span>(est_maee_ind_con)</span></code></pre></div>
<pre><code>## GEE for correlated Gaussian data 
##  Number of Iterations: 6 
## Results for marginal mean parameters 
##      Beta    Estimate MB-stderr BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]    0  0.19231933 0.1048518 0.13134291 0.13722549 0.14337189 0.13681137
## [2,]    1  0.13855318 0.1089971 0.08559214 0.09070281 0.09631631 0.08746208
## [3,]    2  0.14135330 0.1246032 0.09471802 0.10092099 0.10769442 0.10114962
## [4,]    3  0.20421027 0.1452583 0.10146597 0.11068698 0.12096977 0.11160100
## [5,]    4  0.24716971 0.1684305 0.17177784 0.18728285 0.20433337 0.18746260
## [6,]    5 -0.08406266 0.1322349 0.13858326 0.15310151 0.16917367 0.15161045
## 
## Results for correlation parameters 
##      Alpha   Estimate BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]     0 0.09465688 0.02442148 0.02594067 0.02764751 0.02572805
## [2,]     1 0.03469533 0.01939519 0.02047886 0.02163615 0.02033902</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co">### GEE</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>est_uee_ind_con =<span class="st"> </span><span class="kw">geemaee</span>(<span class="dt">y =</span> sampleSWCRT<span class="op">$</span>y_con, </span>
<span id="cb15-3"><a href="#cb15-3"></a>                          <span class="dt">X =</span> X, <span class="dt">id =</span> id, <span class="dt">Z =</span> Z, </span>
<span id="cb15-4"><a href="#cb15-4"></a>                          <span class="dt">family =</span> <span class="st">&quot;continuous&quot;</span>, </span>
<span id="cb15-5"><a href="#cb15-5"></a>                          <span class="dt">maxiter =</span> <span class="dv">500</span>, <span class="dt">epsilon =</span> <span class="fl">0.001</span>, </span>
<span id="cb15-6"><a href="#cb15-6"></a>                          <span class="dt">printrange =</span> <span class="ot">TRUE</span>, <span class="dt">alpadj =</span> <span class="ot">FALSE</span>, </span>
<span id="cb15-7"><a href="#cb15-7"></a>                          <span class="dt">shrink =</span> <span class="st">&quot;ALPHA&quot;</span>, <span class="dt">makevone =</span> <span class="ot">FALSE</span>)</span>
<span id="cb15-8"><a href="#cb15-8"></a><span class="kw">print</span>(est_uee_ind_con)</span></code></pre></div>
<pre><code>## GEE for correlated Gaussian data 
##  Number of Iterations: 4 
## Results for marginal mean parameters 
##      Beta    Estimate MB-stderr BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]    0  0.19190139 0.0996732 0.13145806  0.1373518  0.1435101  0.1369554
## [2,]    1  0.13814149 0.1035213 0.08569554  0.0908225  0.0964508  0.0875894
## [3,]    2  0.14064776 0.1185910 0.09464091  0.1008293  0.1075822  0.1010819
## [4,]    3  0.20346170 0.1383136 0.10102922  0.1101788  0.1203834  0.1111059
## [5,]    4  0.24633487 0.1602727 0.17211627  0.1876575  0.2047488  0.1878631
## [6,]    5 -0.08318282 0.1259570 0.13859217  0.1531209  0.1692063  0.1516836
## 
## Results for correlation parameters 
##      Alpha   Estimate BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]     0 0.08146407 0.02277749 0.02412259 0.02563971 0.02397541
## [2,]     1 0.03076420 0.01819528 0.01919418 0.02026185 0.01907859</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co">### (2) Matrix-adjusted estimating equations and GEE </span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="co">### on binary outcome with nested exchangeable correlation structure</span></span>
<span id="cb17-3"><a href="#cb17-3"></a></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="co">### MAEE</span></span>
<span id="cb17-5"><a href="#cb17-5"></a>est_maee_ind_bin =<span class="st"> </span><span class="kw">geemaee</span>(<span class="dt">y =</span> sampleSWCRT<span class="op">$</span>y_bin, </span>
<span id="cb17-6"><a href="#cb17-6"></a>                           <span class="dt">X =</span> X, <span class="dt">id =</span> id, <span class="dt">Z =</span> Z, </span>
<span id="cb17-7"><a href="#cb17-7"></a>                           <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>, </span>
<span id="cb17-8"><a href="#cb17-8"></a>                           <span class="dt">maxiter =</span> <span class="dv">500</span>, <span class="dt">epsilon =</span> <span class="fl">0.001</span>, </span>
<span id="cb17-9"><a href="#cb17-9"></a>                           <span class="dt">printrange =</span> <span class="ot">TRUE</span>, <span class="dt">alpadj =</span> <span class="ot">TRUE</span>, </span>
<span id="cb17-10"><a href="#cb17-10"></a>                           <span class="dt">shrink =</span> <span class="st">&quot;ALPHA&quot;</span>, <span class="dt">makevone =</span> <span class="ot">FALSE</span>)</span>
<span id="cb17-11"><a href="#cb17-11"></a><span class="kw">print</span>(est_maee_ind_bin)</span></code></pre></div>
<pre><code>## GEE for correlated Gaussian data 
##  Number of Iterations: 7 
## Results for marginal mean parameters 
##      Beta    Estimate MB-stderr BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]    0 -0.03457213 0.2241538  0.2392075  0.2498653  0.2610001  0.2473707
## [2,]    1 -0.34208716 0.2377506  0.2099319  0.2248003  0.2408185  0.2234759
## [3,]    2 -0.67675480 0.2823888  0.2743190  0.2961203  0.3199988  0.2912959
## [4,]    3  0.02997130 0.3119529  0.2000433  0.2183246  0.2399443  0.2115277
## [5,]    4 -0.42930737 0.3863814  0.1803455  0.1973792  0.2176510  0.1991261
## [6,]    5 -0.81816822 0.2919980  0.2800864  0.3069737  0.3365978  0.3032212
## 
## Results for correlation parameters 
##      Alpha   Estimate BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]     0 0.11496936 0.04117568 0.04294094 0.04478275 0.04281833
## [2,]     1 0.06242691 0.03481106 0.03630878 0.03787122 0.03624330</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co">### GEE</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>est_uee_ind_bin =<span class="st"> </span><span class="kw">geemaee</span>(<span class="dt">y =</span> sampleSWCRT<span class="op">$</span>y_bin, </span>
<span id="cb19-3"><a href="#cb19-3"></a>                          <span class="dt">X =</span> X, <span class="dt">id =</span> id, <span class="dt">Z =</span> Z, </span>
<span id="cb19-4"><a href="#cb19-4"></a>                          <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>, </span>
<span id="cb19-5"><a href="#cb19-5"></a>                          <span class="dt">maxiter =</span> <span class="dv">500</span>, <span class="dt">epsilon =</span> <span class="fl">0.001</span>, </span>
<span id="cb19-6"><a href="#cb19-6"></a>                          <span class="dt">printrange =</span> <span class="ot">TRUE</span>, <span class="dt">alpadj =</span> <span class="ot">FALSE</span>, </span>
<span id="cb19-7"><a href="#cb19-7"></a>                          <span class="dt">shrink =</span> <span class="st">&quot;ALPHA&quot;</span>, <span class="dt">makevone =</span> <span class="ot">FALSE</span>)</span>
<span id="cb19-8"><a href="#cb19-8"></a><span class="kw">print</span>(est_uee_ind_bin)</span></code></pre></div>
<pre><code>## GEE for correlated Gaussian data 
##  Number of Iterations: 4 
## Results for marginal mean parameters 
##      Beta    Estimate MB-stderr BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]    0 -0.03532021 0.2130112  0.2391542  0.2498171  0.2609580  0.2472393
## [2,]    1 -0.34154512 0.2256323  0.2100181  0.2248984  0.2409307  0.2236170
## [3,]    2 -0.67644339 0.2683572  0.2745740  0.2964326  0.3203797  0.2916198
## [4,]    3  0.03090417 0.2963087  0.2002704  0.2186117  0.2403231  0.2117340
## [5,]    4 -0.43011798 0.3665889  0.1798608  0.1969091  0.2172283  0.1986538
## [6,]    5 -0.81865546 0.2768705  0.2801134  0.3070590  0.3367553  0.3032859
## 
## Results for correlation parameters 
##      Alpha   Estimate BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]     0 0.09974917 0.03709677 0.03868651 0.04034505 0.03857485
## [2,]     1 0.05686766 0.03128090 0.03262829 0.03403398 0.03256722</code></pre>
</div>
</div>
<div id="cpgeeswd-example-cluster-period-gee-for-estimating-the-marginal-mean-and-correlation-parameters-in-cross-sectional-sw-crts" class="section level2">
<h2><code>cpgeeSWD()</code> example: cluster-period GEE for estimating the marginal mean and correlation parameters in cross-sectional SW-CRTs</h2>
<p>The <code>cpgeeSWD()</code> function implements the cluster-period GEE developed for cross-sectional stepped wedge cluster randomized trials (SW-CRTs). It provides valid estimation and inference for the treatment effect and intraclass correlation parameters within the GEE framework, and is computationally efficient for analyzing SW-CRTs with large cluster sizes. The program currently only allows for a marginal mean model with discrete period effects and the intervention indicator without additional covariates. The program offers bias-corrected ICC estimates as well as bias-corrected sandwich variances for both the treatment effect parameter and the ICC parameters. The technical details of the cluster-period GEE approach are provided in <span class="citation">(Li et al. 2021)</span>.</p>
<div id="simulated-dataset-with-12-clusters-and-4-periods.-1" class="section level3">
<h3>Simulated dataset with 12 clusters and 4 periods.</h3>
<p>We summarize the individual-level simulated SW-CRT data to cluster-period data and use the <code>cpgeeSWD()</code> function to estimate the marginal mean and correlation parameters on cluster-period means of binary outcome. We first transform the variables to get the cluster-period mean outcome <code>y_cp</code>, mean parameters’ design matrix <code>X_cp</code> as well as other arguments.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co">########################################################################</span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="co">### Example 1): simulated SW-CRT with smaller cluster-period sizes (5~10)</span></span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="co">########################################################################</span></span>
<span id="cb21-4"><a href="#cb21-4"></a></span>
<span id="cb21-5"><a href="#cb21-5"></a>sampleSWCRT =<span class="st"> </span>sampleSWCRTSmall</span>
<span id="cb21-6"><a href="#cb21-6"></a></span>
<span id="cb21-7"><a href="#cb21-7"></a><span class="co">### cluster-period id, period, outcome, and design matrix</span></span>
<span id="cb21-8"><a href="#cb21-8"></a><span class="co">### id, period, outcome</span></span>
<span id="cb21-9"><a href="#cb21-9"></a>id =<span class="st"> </span>sampleSWCRT<span class="op">$</span>id; period =<span class="st"> </span>sampleSWCRT<span class="op">$</span>period; y =<span class="st">  </span>sampleSWCRT<span class="op">$</span>y_bin</span>
<span id="cb21-10"><a href="#cb21-10"></a>X =<span class="st"> </span><span class="kw">as.matrix</span>(sampleSWCRT[, <span class="kw">c</span>(<span class="st">&#39;period1&#39;</span>, <span class="st">&#39;period2&#39;</span>, <span class="st">&#39;period3&#39;</span>, <span class="st">&#39;period4&#39;</span>, <span class="st">&#39;treatment&#39;</span>)])</span>
<span id="cb21-11"><a href="#cb21-11"></a> </span>
<span id="cb21-12"><a href="#cb21-12"></a>m =<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">table</span>(id, period)); n =<span class="st"> </span><span class="kw">dim</span>(m)[<span class="dv">1</span>]; t =<span class="st"> </span><span class="kw">dim</span>(m)[<span class="dv">2</span>]</span>
<span id="cb21-13"><a href="#cb21-13"></a>clp_mu =<span class="st"> </span><span class="kw">tapply</span>(y,<span class="kw">list</span>(id,period), <span class="dt">FUN=</span>mean)</span>
<span id="cb21-14"><a href="#cb21-14"></a>y_cp =<span class="st"> </span><span class="kw">c</span>(<span class="kw">t</span>(clp_mu))</span>
<span id="cb21-15"><a href="#cb21-15"></a> </span>
<span id="cb21-16"><a href="#cb21-16"></a><span class="co">### design matrix for correlation parameters</span></span>
<span id="cb21-17"><a href="#cb21-17"></a>trt =<span class="st"> </span><span class="kw">tapply</span>(X[, t <span class="op">+</span><span class="st"> </span><span class="dv">1</span>], <span class="kw">list</span>(id, period), <span class="dt">FUN=</span>mean)</span>
<span id="cb21-18"><a href="#cb21-18"></a>trt =<span class="st"> </span><span class="kw">c</span>(<span class="kw">t</span>(trt))</span>
<span id="cb21-19"><a href="#cb21-19"></a></span>
<span id="cb21-20"><a href="#cb21-20"></a>time =<span class="st"> </span><span class="kw">tapply</span>(period,<span class="kw">list</span>(id, period), <span class="dt">FUN =</span> mean); time =<span class="st"> </span><span class="kw">c</span>(<span class="kw">t</span>(time))</span>
<span id="cb21-21"><a href="#cb21-21"></a>X_cp =<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, n <span class="op">*</span><span class="st"> </span>t, t)</span>
<span id="cb21-22"><a href="#cb21-22"></a></span>
<span id="cb21-23"><a href="#cb21-23"></a>s =<span class="st"> </span><span class="dv">1</span></span>
<span id="cb21-24"><a href="#cb21-24"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n) { <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>t) { X_cp[s, time[s]] =<span class="st"> </span><span class="dv">1</span>; s =<span class="st"> </span>s <span class="op">+</span><span class="st"> </span><span class="dv">1</span> }}</span>
<span id="cb21-25"><a href="#cb21-25"></a>X_cp =<span class="st"> </span><span class="kw">cbind</span>(X_cp, trt); id_cp =<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span>n, <span class="dt">each =</span> t); m_cp =<span class="st">  </span><span class="kw">c</span>(<span class="kw">t</span>(m))</span></code></pre></div>
<p>We implement the <code>cpgeeSWD()</code> function on all the three choices of the correlation structure including <code>&quot;exchangeable&quot;</code>, <code>&quot;nest_exch&quot;</code> and <code>&quot;exp_decay&quot;</code>. We consider both matrix-adjusted estimating equations (MAEE) with <code>alpadj = TRUE</code> and uncorrected generalized estimating equations (GEE) with <code>alpadj = FALSE</code>.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co">### cluster-period matrix-adjusted estimating equations (MAEE) </span></span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="co">### with exchangeable, nested exchangeable and exponential decay correlation structures </span></span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="co"># exponential</span></span>
<span id="cb22-4"><a href="#cb22-4"></a>est_maee_exc =<span class="st"> </span><span class="kw">cpgeeSWD</span>(<span class="dt">y =</span> y_cp, <span class="dt">X =</span> X_cp, <span class="dt">id =</span> id_cp, </span>
<span id="cb22-5"><a href="#cb22-5"></a>                        <span class="dt">m =</span> m_cp, <span class="dt">corstr =</span> <span class="st">&quot;exchangeable&quot;</span>, </span>
<span id="cb22-6"><a href="#cb22-6"></a>                        <span class="dt">alpadj =</span> <span class="ot">TRUE</span>)</span>
<span id="cb22-7"><a href="#cb22-7"></a><span class="kw">print</span>(est_maee_exc)</span></code></pre></div>
<pre><code>## GEE and MAEE for Cluster-Period Summaries 
##  Number of Iterations: 4 
## Results for marginal mean parameters 
##      Beta   Estimate MB-stderr BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]    0 -0.7678066 0.2703014  0.2394340  0.2506194  0.2623375  0.2575649
## [2,]    1 -0.4899672 0.2929374  0.3175202  0.3415573  0.3679292  0.3465760
## [3,]    2 -0.6692544 0.3719364  0.5582006  0.6161580  0.6810928  0.6184389
## [4,]    3 -0.5967261 0.5257133  0.5630605  0.6178896  0.6788478  0.6378908
## [5,]    4 -0.9712041 0.4316492  0.5346929  0.5883089  0.6479608  0.5905832
## 
## Results for correlation parameters 
##      Alpha   Estimate BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]     0 0.07171243 0.03869076 0.04059179  0.0425914 0.04058122</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># nested exchangeable</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>est_maee_nex =<span class="st"> </span><span class="kw">cpgeeSWD</span>(<span class="dt">y =</span> y_cp, <span class="dt">X =</span> X_cp, <span class="dt">id =</span> id_cp, </span>
<span id="cb24-3"><a href="#cb24-3"></a>                        <span class="dt">m =</span> m_cp, <span class="dt">corstr =</span> <span class="st">&quot;nest_exch&quot;</span>, </span>
<span id="cb24-4"><a href="#cb24-4"></a>                        <span class="dt">alpadj =</span> <span class="ot">TRUE</span>)</span>
<span id="cb24-5"><a href="#cb24-5"></a><span class="kw">print</span>(est_maee_nex)</span></code></pre></div>
<pre><code>## GEE and MAEE for Cluster-Period Summaries 
##  Number of Iterations: 6 
## Results for marginal mean parameters 
##      Beta   Estimate MB-stderr BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]    0 -0.7721492 0.2931061  0.2388699  0.2498629  0.2613680  0.2533655
## [2,]    1 -0.5036505 0.3216055  0.3154306  0.3394624  0.3658386  0.3392457
## [3,]    2 -0.6217770 0.4152335  0.5684728  0.6271700  0.6927849  0.6233328
## [4,]    3 -0.5994803 0.5967744  0.5467135  0.6003143  0.6598640  0.6091679
## [5,]    4 -0.9861662 0.4905999  0.5305528  0.5839117  0.6431778  0.5821589
## 
## Results for correlation parameters 
##      Alpha   Estimate BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]     0 0.10820010 0.04714541 0.04951304 0.05200312 0.04952131
## [2,]     1 0.05385588 0.03727153 0.03907559 0.04097119 0.03907206</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="co"># exponential decay </span></span>
<span id="cb26-2"><a href="#cb26-2"></a>est_maee_ed =<span class="st"> </span><span class="kw">cpgeeSWD</span>(<span class="dt">y  =</span> y_cp, <span class="dt">X =</span> X_cp, <span class="dt">id =</span> id_cp, </span>
<span id="cb26-3"><a href="#cb26-3"></a>                       <span class="dt">m =</span> m_cp, <span class="dt">corstr =</span> <span class="st">&quot;exp_decay&quot;</span>, </span>
<span id="cb26-4"><a href="#cb26-4"></a>                       <span class="dt">alpadj =</span> <span class="ot">TRUE</span>)</span>
<span id="cb26-5"><a href="#cb26-5"></a><span class="kw">print</span>(est_maee_ed)</span></code></pre></div>
<pre><code>## GEE and MAEE for Cluster-Period Summaries 
##  Number of Iterations: 7 
## Results for marginal mean parameters 
##      Beta   Estimate MB-stderr BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]    0 -0.7710180 0.2950154  0.2375293  0.2483319  0.2596306  0.2513006
## [2,]    1 -0.4988642 0.3224197  0.3145635  0.3388380  0.3654862  0.3397012
## [3,]    2 -0.6284311 0.4156078  0.5720337  0.6309674  0.6968561  0.6305171
## [4,]    3 -0.6140801 0.5986182  0.5461283  0.5997932  0.6594254  0.6124552
## [5,]    4 -0.9866725 0.4904297  0.5309814  0.5843712  0.6436174  0.5841529
## 
## Results for correlation parameters 
##      Alpha  Estimate BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]     0 0.1115235  0.0471122 0.04949153 0.05199521 0.04946812
## [2,]     1 0.6158576  0.1759633 0.18398863 0.19240603 0.18381541</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="co">### cluster-period GEE </span></span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="co">### with exchangeable, nested exchangeable and exponential decay correlation structures</span></span>
<span id="cb28-3"><a href="#cb28-3"></a></span>
<span id="cb28-4"><a href="#cb28-4"></a><span class="co"># exchangeable</span></span>
<span id="cb28-5"><a href="#cb28-5"></a>est_uee_exc &lt;-<span class="st"> </span><span class="kw">cpgeeSWD</span>(<span class="dt">y =</span> y_cp, <span class="dt">X =</span> X_cp, <span class="dt">id =</span> id_cp, </span>
<span id="cb28-6"><a href="#cb28-6"></a>                        <span class="dt">m =</span> m_cp, <span class="dt">corstr =</span> <span class="st">&quot;exchangeable&quot;</span>,</span>
<span id="cb28-7"><a href="#cb28-7"></a>                        <span class="dt">alpadj =</span> <span class="ot">FALSE</span>)</span>
<span id="cb28-8"><a href="#cb28-8"></a><span class="kw">print</span>(est_uee_exc)</span></code></pre></div>
<pre><code>## GEE and MAEE for Cluster-Period Summaries 
##  Number of Iterations: 4 
## Results for marginal mean parameters 
##      Beta   Estimate MB-stderr BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]    0 -0.7679011 0.2611220  0.2398530  0.2510783  0.2628390  0.2564986
## [2,]    1 -0.4911553 0.2852177  0.3154908  0.3393963  0.3656321  0.3424027
## [3,]    2 -0.6697603 0.3647602  0.5627720  0.6215708  0.6874968  0.6213395
## [4,]    3 -0.5940272 0.5205574  0.5631388  0.6182225  0.6795178  0.6340687
## [5,]    4 -0.9751028 0.4299957  0.5367262  0.5907718  0.6509467  0.5916886
## 
## Results for correlation parameters 
##      Alpha   Estimate BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]     0 0.05725857 0.03375491 0.03539291 0.03711574 0.03538186</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="co"># nested exchangeable</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>est_uee_nex &lt;-<span class="st"> </span><span class="kw">cpgeeSWD</span>(<span class="dt">y =</span> y_cp, <span class="dt">X =</span> X_cp, <span class="dt">id =</span> id_cp, </span>
<span id="cb30-3"><a href="#cb30-3"></a>                        <span class="dt">m =</span> m_cp, <span class="dt">corstr =</span> <span class="st">&quot;nest_exch&quot;</span>, </span>
<span id="cb30-4"><a href="#cb30-4"></a>                        <span class="dt">alpadj =</span> <span class="ot">FALSE</span>)</span>
<span id="cb30-5"><a href="#cb30-5"></a><span class="kw">print</span>(est_uee_nex)</span></code></pre></div>
<pre><code>## GEE and MAEE for Cluster-Period Summaries 
##  Number of Iterations: 4 
## Results for marginal mean parameters 
##      Beta   Estimate MB-stderr BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]    0 -0.7701899 0.2728928  0.2396011  0.2507209  0.2623647  0.2544085
## [2,]    1 -0.4993131 0.2999219  0.3142455  0.3381255  0.3643392  0.3384140
## [3,]    2 -0.6424236 0.3867725  0.5686219  0.6278135  0.6940831  0.6244480
## [4,]    3 -0.5956930 0.5566382  0.5540211  0.6083847  0.6688445  0.6182629
## [5,]    4 -0.9836857 0.4595437  0.5345098  0.5883958  0.6483261  0.5870942
## 
## Results for correlation parameters 
##      Alpha   Estimate BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]     0 0.07500427 0.03992967 0.04189842 0.04396787 0.04190479
## [2,]     1 0.04814669 0.03293754 0.03450776 0.03615783 0.03449733</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="co"># exponential decay </span></span>
<span id="cb32-2"><a href="#cb32-2"></a>est_uee_ed &lt;-<span class="st"> </span><span class="kw">cpgeeSWD</span>(<span class="dt">y =</span> y_cp, <span class="dt">X =</span> X_cp, <span class="dt">id =</span> id_cp, </span>
<span id="cb32-3"><a href="#cb32-3"></a>                       <span class="dt">m =</span> m_cp, <span class="dt">corstr =</span> <span class="st">&#39;exp_decay&#39;</span>, </span>
<span id="cb32-4"><a href="#cb32-4"></a>                       <span class="dt">alpadj =</span> <span class="ot">FALSE</span>)</span>
<span id="cb32-5"><a href="#cb32-5"></a><span class="kw">print</span>(est_uee_ed)</span></code></pre></div>
<pre><code>## GEE and MAEE for Cluster-Period Summaries 
##  Number of Iterations: 4 
## Results for marginal mean parameters 
##      Beta   Estimate MB-stderr BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]    0 -0.7691313 0.2760920  0.2385661  0.2495298  0.2610036  0.2526378
## [2,]    1 -0.4960302 0.3027753  0.3135021  0.3375362  0.3639236  0.3382822
## [3,]    2 -0.6436889 0.3904936  0.5720324  0.6315468  0.6981797  0.6302718
## [4,]    3 -0.6064791 0.5635697  0.5533253  0.6077753  0.6683419  0.6196995
## [5,]    4 -0.9866876 0.4640753  0.5348939  0.5888701  0.6488594  0.5884695
## 
## Results for correlation parameters 
##      Alpha  Estimate BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]     0 0.0800789 0.04026846 0.04227077 0.04437711 0.04228027
## [2,]     1 0.7046177 0.17583729 0.18376072 0.19206554 0.18353049</code></pre>
</div>
<div id="simulated-dataset-with-12-clusters-and-5-periods-1" class="section level3">
<h3>Simulated dataset with 12 clusters and 5 periods</h3>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="co">########################################################################</span></span>
<span id="cb34-2"><a href="#cb34-2"></a><span class="co">### Example 2): simulated SW-CRT with larger cluster-period sizes (20~30)</span></span>
<span id="cb34-3"><a href="#cb34-3"></a><span class="co">########################################################################</span></span>
<span id="cb34-4"><a href="#cb34-4"></a></span>
<span id="cb34-5"><a href="#cb34-5"></a>sampleSWCRT =<span class="st"> </span>sampleSWCRTLarge</span>
<span id="cb34-6"><a href="#cb34-6"></a></span>
<span id="cb34-7"><a href="#cb34-7"></a><span class="co">### cluster-period id, period, outcome, and design matrix</span></span>
<span id="cb34-8"><a href="#cb34-8"></a><span class="co">### id, period, outcome</span></span>
<span id="cb34-9"><a href="#cb34-9"></a>id =<span class="st"> </span>sampleSWCRT<span class="op">$</span>id; period =<span class="st">  </span>sampleSWCRT<span class="op">$</span>period; y =<span class="st">  </span>sampleSWCRT<span class="op">$</span>y_bin</span>
<span id="cb34-10"><a href="#cb34-10"></a>X =<span class="st"> </span><span class="kw">as.matrix</span>(sampleSWCRT[, <span class="kw">c</span>(<span class="st">&#39;period1&#39;</span>, <span class="st">&#39;period2&#39;</span>, <span class="st">&#39;period3&#39;</span>, <span class="st">&#39;period4&#39;</span>, <span class="st">&#39;period5&#39;</span>, <span class="st">&#39;treatment&#39;</span>)])</span>
<span id="cb34-11"><a href="#cb34-11"></a> </span>
<span id="cb34-12"><a href="#cb34-12"></a>m =<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">table</span>(id, period)); n =<span class="st"> </span><span class="kw">dim</span>(m)[<span class="dv">1</span>]; t =<span class="st"> </span><span class="kw">dim</span>(m)[<span class="dv">2</span>]</span>
<span id="cb34-13"><a href="#cb34-13"></a>clp_mu&lt;-<span class="kw">tapply</span>(y,<span class="kw">list</span>(id,period), <span class="dt">FUN=</span>mean)</span>
<span id="cb34-14"><a href="#cb34-14"></a>y_cp &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">t</span>(clp_mu))</span>
<span id="cb34-15"><a href="#cb34-15"></a> </span>
<span id="cb34-16"><a href="#cb34-16"></a><span class="co">### design matrix for correlation parameters</span></span>
<span id="cb34-17"><a href="#cb34-17"></a>trt &lt;-<span class="st"> </span><span class="kw">tapply</span>(X[, t <span class="op">+</span><span class="st"> </span><span class="dv">1</span>], <span class="kw">list</span>(id, period), <span class="dt">FUN=</span>mean)</span>
<span id="cb34-18"><a href="#cb34-18"></a>trt &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">t</span>(trt))</span>
<span id="cb34-19"><a href="#cb34-19"></a></span>
<span id="cb34-20"><a href="#cb34-20"></a>time &lt;-<span class="st"> </span><span class="kw">tapply</span>(period,<span class="kw">list</span>(id, period), <span class="dt">FUN =</span> mean); time &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">t</span>(time))</span>
<span id="cb34-21"><a href="#cb34-21"></a>X_cp &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, n <span class="op">*</span><span class="st"> </span>t, t)</span>
<span id="cb34-22"><a href="#cb34-22"></a></span>
<span id="cb34-23"><a href="#cb34-23"></a>s =<span class="st"> </span><span class="dv">1</span></span>
<span id="cb34-24"><a href="#cb34-24"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n){<span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>t){X_cp[s, time[s]] &lt;-<span class="st"> </span><span class="dv">1</span>; s =<span class="st"> </span>s <span class="op">+</span><span class="st"> </span><span class="dv">1</span>}}</span>
<span id="cb34-25"><a href="#cb34-25"></a>X_cp &lt;-<span class="st"> </span><span class="kw">cbind</span>(X_cp, trt); id_cp &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span>n, <span class="dt">each=</span> t); m_cp &lt;-<span class="st">  </span><span class="kw">c</span>(<span class="kw">t</span>(m))</span>
<span id="cb34-26"><a href="#cb34-26"></a></span>
<span id="cb34-27"><a href="#cb34-27"></a><span class="co">### cluster-period matrix-adjusted estimating equations (MAEE) </span></span>
<span id="cb34-28"><a href="#cb34-28"></a><span class="co">### with exchangeable, nested exchangeable and exponential decay correlation structures </span></span>
<span id="cb34-29"><a href="#cb34-29"></a><span class="co"># exponential</span></span>
<span id="cb34-30"><a href="#cb34-30"></a>est_maee_exc &lt;-<span class="st"> </span><span class="kw">cpgeeSWD</span>(<span class="dt">y =</span> y_cp, <span class="dt">X =</span> X_cp, <span class="dt">id =</span> id_cp, </span>
<span id="cb34-31"><a href="#cb34-31"></a>                         <span class="dt">m =</span> m_cp, <span class="dt">corstr =</span> <span class="st">&quot;exchangeable&quot;</span>, </span>
<span id="cb34-32"><a href="#cb34-32"></a>                         <span class="dt">alpadj =</span> <span class="ot">TRUE</span>)</span>
<span id="cb34-33"><a href="#cb34-33"></a><span class="kw">print</span>(est_maee_exc)</span></code></pre></div>
<pre><code>## GEE and MAEE for Cluster-Period Summaries 
##  Number of Iterations: 4 
## Results for marginal mean parameters 
##      Beta    Estimate MB-stderr BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]    0 -0.03937150 0.1955148  0.2373442  0.2480663  0.2592915  0.2392651
## [2,]    1 -0.33407908 0.2022096  0.2200174  0.2352782  0.2517452  0.2396738
## [3,]    2 -0.67338220 0.2343484  0.2944134  0.3178251  0.3435471  0.3183472
## [4,]    3  0.04608714 0.2414272  0.2332480  0.2536047  0.2774156  0.2480103
## [5,]    4 -0.43352358 0.2901120  0.1710562  0.1877125  0.2079820  0.1965489
## [6,]    5 -0.82493433 0.1977208  0.2758767  0.3031771  0.3333531  0.3000391
## 
## Results for correlation parameters 
##      Alpha   Estimate BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]     0 0.07782417 0.03688003 0.03829676 0.03976975 0.03827983</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="co"># nested exchangeable</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>est_maee_nex &lt;-<span class="st"> </span><span class="kw">cpgeeSWD</span>(<span class="dt">y =</span> y_cp, <span class="dt">X =</span> X_cp, <span class="dt">id =</span> id_cp, </span>
<span id="cb36-3"><a href="#cb36-3"></a>                         <span class="dt">m =</span> m_cp, <span class="dt">corstr =</span> <span class="st">&quot;nest_exch&quot;</span>, </span>
<span id="cb36-4"><a href="#cb36-4"></a>                         <span class="dt">alpadj =</span> <span class="ot">TRUE</span>)</span>
<span id="cb36-5"><a href="#cb36-5"></a><span class="kw">print</span>(est_maee_nex)</span></code></pre></div>
<pre><code>## GEE and MAEE for Cluster-Period Summaries 
##  Number of Iterations: 4 
## Results for marginal mean parameters 
##      Beta    Estimate MB-stderr BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]    0 -0.03432555 0.2278441  0.2393377  0.2499941  0.2611267  0.2479004
## [2,]    1 -0.34293068 0.2424034  0.2082967  0.2231294  0.2391131  0.2212194
## [3,]    2 -0.67730319 0.2887517  0.2713904  0.2930314  0.3167289  0.2876482
## [4,]    3  0.02825126 0.3212402  0.1938752  0.2119627  0.2334399  0.2046802
## [5,]    4 -0.42990720 0.3990553  0.1849263  0.2025603  0.2234539  0.2035330
## [6,]    5 -0.81687942 0.3038572  0.2835181  0.3107636  0.3407871  0.3069380
## 
## Results for correlation parameters 
##      Alpha  Estimate BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]     0 0.1201529 0.04650374 0.04831496 0.05019968 0.04830353
## [2,]     1 0.0584004 0.03424640 0.03557674 0.03696081 0.03558240</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="co"># exponential decay </span></span>
<span id="cb38-2"><a href="#cb38-2"></a>est_maee_ed &lt;-<span class="st"> </span><span class="kw">cpgeeSWD</span>(<span class="dt">y  =</span> y_cp, <span class="dt">X =</span> X_cp, <span class="dt">id =</span> id_cp, </span>
<span id="cb38-3"><a href="#cb38-3"></a>                        <span class="dt">m =</span> m_cp, <span class="dt">corstr =</span> <span class="st">&quot;exp_decay&quot;</span>, </span>
<span id="cb38-4"><a href="#cb38-4"></a>                        <span class="dt">alpadj =</span> <span class="ot">TRUE</span>)</span>
<span id="cb38-5"><a href="#cb38-5"></a><span class="kw">print</span>(est_maee_ed)</span></code></pre></div>
<pre><code>## GEE and MAEE for Cluster-Period Summaries 
##  Number of Iterations: 7 
## Results for marginal mean parameters 
##      Beta    Estimate MB-stderr BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]    0 -0.03340439 0.2236591  0.2415963  0.2524580  0.2638106  0.2513261
## [2,]    1 -0.32963269 0.2361087  0.2096366  0.2232709  0.2378969  0.2223343
## [3,]    2 -0.66086972 0.2793325  0.2679038  0.2864419  0.3065960  0.2820858
## [4,]    3  0.05215247 0.3068537  0.2126799  0.2276517  0.2447418  0.2231794
## [5,]    4 -0.38679195 0.3815072  0.1392210  0.1482120  0.1597143  0.1537140
## [6,]    5 -0.85944259 0.2843752  0.2312996  0.2529042  0.2766009  0.2467741
## 
## Results for correlation parameters 
##      Alpha  Estimate BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]     0 0.1143454 0.04222592 0.04384679 0.04553347 0.04380728
## [2,]     1 0.7000112 0.14390913 0.15014145 0.15665442 0.15034373</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="co">### cluster-period GEE </span></span>
<span id="cb40-2"><a href="#cb40-2"></a><span class="co">### with exchangeable, nested exchangeable and exponential decay correlation structures</span></span>
<span id="cb40-3"><a href="#cb40-3"></a></span>
<span id="cb40-4"><a href="#cb40-4"></a><span class="co"># exchangeable</span></span>
<span id="cb40-5"><a href="#cb40-5"></a>est_uee_exc &lt;-<span class="st"> </span><span class="kw">cpgeeSWD</span>(<span class="dt">y =</span> y_cp, <span class="dt">X =</span> X_cp, <span class="dt">id =</span> id_cp, </span>
<span id="cb40-6"><a href="#cb40-6"></a>                        <span class="dt">m =</span> m_cp, <span class="dt">corstr =</span> <span class="st">&quot;exchangeable&quot;</span>,</span>
<span id="cb40-7"><a href="#cb40-7"></a>                        <span class="dt">alpadj =</span> <span class="ot">FALSE</span>)</span>
<span id="cb40-8"><a href="#cb40-8"></a><span class="kw">print</span>(est_uee_exc)</span></code></pre></div>
<pre><code>## GEE and MAEE for Cluster-Period Summaries 
##  Number of Iterations: 3 
## Results for marginal mean parameters 
##      Beta    Estimate MB-stderr BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]    0 -0.03987191 0.1891780  0.2375607  0.2482853  0.2595112  0.2404060
## [2,]    1 -0.33454114 0.1959210  0.2189623  0.2341927  0.2506256  0.2376880
## [3,]    2 -0.67375572 0.2281604  0.2923708  0.3156737  0.3412787  0.3152896
## [4,]    3  0.04529970 0.2371119  0.2301168  0.2503246  0.2740128  0.2444258
## [5,]    4 -0.43427752 0.2857409  0.1708179  0.1874729  0.2077462  0.1952451
## [6,]    5 -0.82467526 0.1978609  0.2760276  0.3033256  0.3334993  0.3001943
## 
## Results for correlation parameters 
##      Alpha   Estimate BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]     0 0.07013385 0.03368912 0.03498342 0.03632918 0.03496968</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="co"># nested exchangeable</span></span>
<span id="cb42-2"><a href="#cb42-2"></a>est_uee_nex &lt;-<span class="st"> </span><span class="kw">cpgeeSWD</span>(<span class="dt">y =</span> y_cp, <span class="dt">X =</span> X_cp, <span class="dt">id =</span> id_cp, </span>
<span id="cb42-3"><a href="#cb42-3"></a>                        <span class="dt">m =</span> m_cp, <span class="dt">corstr =</span> <span class="st">&quot;nest_exch&quot;</span>, </span>
<span id="cb42-4"><a href="#cb42-4"></a>                        <span class="dt">alpadj =</span> <span class="ot">FALSE</span>)</span>
<span id="cb42-5"><a href="#cb42-5"></a><span class="kw">print</span>(est_uee_nex)</span></code></pre></div>
<pre><code>## GEE and MAEE for Cluster-Period Summaries 
##  Number of Iterations: 3 
## Results for marginal mean parameters 
##      Beta    Estimate MB-stderr BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]    0 -0.03499108 0.2169350  0.2392903  0.2499507  0.2610881  0.2477876
## [2,]    1 -0.34245090 0.2305101  0.2084051  0.2232474  0.2392423  0.2213878
## [3,]    2 -0.67698816 0.2749173  0.2716631  0.2933535  0.3171098  0.2879913
## [4,]    3  0.02904193 0.3057033  0.1942266  0.2123667  0.2339216  0.2050350
## [5,]    4 -0.43058289 0.3793522  0.1842784  0.2018893  0.2227843  0.2028661
## [6,]    5 -0.81733511 0.2886977  0.2833499  0.3106202  0.3406770  0.3067671
## 
## Results for correlation parameters 
##      Alpha   Estimate BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]     0 0.10499225 0.04215716 0.04379742 0.04550421 0.04378621
## [2,]     1 0.05350042 0.03080632 0.03200335 0.03324877 0.03200919</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="co"># exponential decay </span></span>
<span id="cb44-2"><a href="#cb44-2"></a>est_uee_ed &lt;-<span class="st"> </span><span class="kw">cpgeeSWD</span>(<span class="dt">y =</span> y_cp, <span class="dt">X =</span> X_cp, <span class="dt">id =</span> id_cp, </span>
<span id="cb44-3"><a href="#cb44-3"></a>                       <span class="dt">m =</span> m_cp, <span class="dt">corstr =</span> <span class="st">&#39;exp_decay&#39;</span>, </span>
<span id="cb44-4"><a href="#cb44-4"></a>                       <span class="dt">alpadj =</span> <span class="ot">FALSE</span>)</span>
<span id="cb44-5"><a href="#cb44-5"></a><span class="kw">print</span>(est_uee_ed)</span></code></pre></div>
<pre><code>## GEE and MAEE for Cluster-Period Summaries 
##  Number of Iterations: 4 
## Results for marginal mean parameters 
##      Beta    Estimate MB-stderr BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]    0 -0.03459151 0.2123822  0.2414782  0.2523416  0.2636966  0.2510466
## [2,]    1 -0.33001054 0.2238965  0.2100290  0.2237648  0.2385050  0.2228663
## [3,]    2 -0.66158744 0.2652147  0.2697183  0.2886630  0.3092792  0.2844552
## [4,]    3  0.05115744 0.2911203  0.2127361  0.2279738  0.2454327  0.2231941
## [5,]    4 -0.38956628 0.3612911  0.1403145  0.1497434  0.1617831  0.1547516
## [6,]    5 -0.85722995 0.2692278  0.2336074  0.2555548  0.2796454  0.2493893
## 
## Results for correlation parameters 
##      Alpha  Estimate BC0-stderr BC1-stderr BC2-stderr BC3-stderr
## [1,]     0 0.0989716 0.03850721 0.03997936 0.04151109 0.03993102
## [2,]     1 0.7279137 0.13726650 0.14328210 0.14956972 0.14351625</code></pre>
</div>
</div>
<div id="simbinprobit-example-generating-correlated-binary-data-using-the-multivariate-probit-method" class="section level2">
<h2><code>simbinPROBIT()</code> example: generating correlated binary data using the multivariate probit method</h2>
<p>The <code>simbinPROBIT()</code> function generates correlated binary data using the multivariate Probit method <span class="citation">(Emrich and Piedmonte 1991)</span>. It simulates a vector of binary outcomes according the specified marginal mean vector and correlation structure. Constraints and compatibility between the marginal mean and correlation matrix are checked.</p>
<p>We use the <code>simbinPROBIT()</code> function to generate correlated binary data with different correlation structures. We consider simulating a cross-sectional SW-CRT dataset with 2 clusters, 3 periods with the same cluster-period size of 5. We use two mean vectors for the two clusters and specify the <code>mu</code> argument.</p>
<p>For the exchangeable correlation structure, we specify both the within-period and inter-period correlation parameters to be <code>0.015</code>. We use <code>0.03</code> and <code>0.015</code> for the within-period and inter-period correlations, respectively. The exponential decay correlation structure has an decay parameter <code>0.8</code> with the within-period correlation parameter <code>0.03</code>.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="co">#### Simulate 2 clusters, 3 periods and cluster-period size of 5</span></span>
<span id="cb46-2"><a href="#cb46-2"></a></span>
<span id="cb46-3"><a href="#cb46-3"></a>t =<span class="st"> </span><span class="dv">3</span>; n =<span class="st"> </span><span class="dv">2</span>; m =<span class="st"> </span><span class="dv">5</span></span>
<span id="cb46-4"><a href="#cb46-4"></a><span class="co"># means of cluster 1</span></span>
<span id="cb46-5"><a href="#cb46-5"></a>u_c1 =<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.4</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span>)</span>
<span id="cb46-6"><a href="#cb46-6"></a>u1 &lt;-<span class="st"> </span><span class="kw">rep</span>(u_c1, <span class="kw">c</span>(<span class="kw">rep</span>(m, t)))</span>
<span id="cb46-7"><a href="#cb46-7"></a><span class="co"># means of cluster 2</span></span>
<span id="cb46-8"><a href="#cb46-8"></a>u_c2 =<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.35</span>, <span class="fl">0.25</span>, <span class="fl">0.2</span>)</span>
<span id="cb46-9"><a href="#cb46-9"></a>u2 &lt;-<span class="st"> </span><span class="kw">rep</span>(u_c2, <span class="kw">c</span>(<span class="kw">rep</span>(m, t)))</span>
<span id="cb46-10"><a href="#cb46-10"></a></span>
<span id="cb46-11"><a href="#cb46-11"></a><span class="co"># List of mean vectors</span></span>
<span id="cb46-12"><a href="#cb46-12"></a>mu =<span class="st"> </span><span class="kw">list</span>(); mu[[<span class="dv">1</span>]] =<span class="st"> </span>u1; mu[[<span class="dv">2</span>]] =<span class="st"> </span>u2;</span>
<span id="cb46-13"><a href="#cb46-13"></a></span>
<span id="cb46-14"><a href="#cb46-14"></a><span class="co"># List of correlation matrices</span></span>
<span id="cb46-15"><a href="#cb46-15"></a></span>
<span id="cb46-16"><a href="#cb46-16"></a><span class="co">## correlation parameters</span></span>
<span id="cb46-17"><a href="#cb46-17"></a>alpha0 =<span class="st"> </span><span class="fl">0.03</span>; alpha1 =<span class="st"> </span><span class="fl">0.015</span>; rho =<span class="st"> </span><span class="fl">0.8</span></span>
<span id="cb46-18"><a href="#cb46-18"></a></span>
<span id="cb46-19"><a href="#cb46-19"></a><span class="co">## (1) exchangeable</span></span>
<span id="cb46-20"><a href="#cb46-20"></a>Sigma =<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb46-21"><a href="#cb46-21"></a>Sigma[[<span class="dv">1</span>]] =<span class="st"> </span><span class="kw">diag</span>(m <span class="op">*</span><span class="st"> </span>t) <span class="op">*</span><span class="st"> </span>( <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>alpha1) <span class="op">+</span><span class="st"> </span><span class="kw">matrix</span>(alpha1, m <span class="op">*</span><span class="st"> </span>t,  m <span class="op">*</span><span class="st"> </span>t )</span>
<span id="cb46-22"><a href="#cb46-22"></a></span>
<span id="cb46-23"><a href="#cb46-23"></a>Sigma[[<span class="dv">2</span>]] =<span class="st"> </span><span class="kw">diag</span>(m <span class="op">*</span><span class="st"> </span>t) <span class="op">*</span><span class="st"> </span>( <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>alpha1) <span class="op">+</span><span class="st"> </span><span class="kw">matrix</span>(alpha1, m <span class="op">*</span><span class="st"> </span>t,  m <span class="op">*</span><span class="st"> </span>t )</span>
<span id="cb46-24"><a href="#cb46-24"></a></span>
<span id="cb46-25"><a href="#cb46-25"></a>y_exc =<span class="st"> </span><span class="kw">simbinPROBIT</span>(<span class="dt">mu =</span> mu, <span class="dt">Sigma =</span> Sigma, <span class="dt">n =</span> n)</span>
<span id="cb46-26"><a href="#cb46-26"></a></span>
<span id="cb46-27"><a href="#cb46-27"></a><span class="co">## (2) nested exchangeable</span></span>
<span id="cb46-28"><a href="#cb46-28"></a>Sigma =<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb46-29"><a href="#cb46-29"></a>cor_matrix =<span class="st"> </span><span class="kw">matrix</span>(alpha1, m <span class="op">*</span><span class="st"> </span>t,  m <span class="op">*</span><span class="st"> </span>t)</span>
<span id="cb46-30"><a href="#cb46-30"></a>loc1 =<span class="st"> </span><span class="dv">0</span>; loc2 =<span class="st"> </span><span class="dv">0</span></span>
<span id="cb46-31"><a href="#cb46-31"></a><span class="cf">for</span>(t <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>t){loc1 =<span class="st"> </span>loc2 <span class="op">+</span><span class="st"> </span><span class="dv">1</span>; loc2 =<span class="st"> </span>loc1 <span class="op">+</span><span class="st"> </span>m <span class="op">-</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb46-32"><a href="#cb46-32"></a>  <span class="cf">for</span>(i <span class="cf">in</span> loc1<span class="op">:</span>loc2){<span class="cf">for</span>(j <span class="cf">in</span> loc1<span class="op">:</span>loc2){</span>
<span id="cb46-33"><a href="#cb46-33"></a>         <span class="cf">if</span>(i <span class="op">!=</span><span class="st"> </span>j){cor_matrix[i, j] =<span class="st"> </span>alpha0}<span class="cf">else</span>{cor_matrix[i, j] =<span class="st"> </span><span class="dv">1</span>}}}}</span>
<span id="cb46-34"><a href="#cb46-34"></a> </span>
<span id="cb46-35"><a href="#cb46-35"></a>Sigma[[<span class="dv">1</span>]] =<span class="st"> </span>cor_matrix; Sigma[[<span class="dv">2</span>]] =<span class="st"> </span>cor_matrix</span>
<span id="cb46-36"><a href="#cb46-36"></a></span>
<span id="cb46-37"><a href="#cb46-37"></a>y_nex =<span class="st"> </span><span class="kw">simbinPROBIT</span>(<span class="dt">mu =</span> mu, <span class="dt">Sigma =</span> Sigma, <span class="dt">n =</span> n)</span>
<span id="cb46-38"><a href="#cb46-38"></a></span>
<span id="cb46-39"><a href="#cb46-39"></a><span class="co">## (3) exponential decay</span></span>
<span id="cb46-40"><a href="#cb46-40"></a> </span>
<span id="cb46-41"><a href="#cb46-41"></a>Sigma =<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb46-42"><a href="#cb46-42"></a> </span>
<span id="cb46-43"><a href="#cb46-43"></a><span class="co">### function to find the period of the ith index</span></span>
<span id="cb46-44"><a href="#cb46-44"></a> region_ij&lt;-<span class="cf">function</span>(points, i){diff =<span class="st"> </span>i <span class="op">-</span><span class="st"> </span>points</span>
<span id="cb46-45"><a href="#cb46-45"></a>     <span class="cf">for</span>(h <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(<span class="kw">length</span>(diff) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)){<span class="cf">if</span>(diff[h] <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>diff[h <span class="op">+</span><span class="st"> </span><span class="dv">1</span>] <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>){find &lt;-<span class="st"> </span>h}}</span>
<span id="cb46-46"><a href="#cb46-46"></a>  <span class="kw">return</span>(find)}</span>
<span id="cb46-47"><a href="#cb46-47"></a></span>
<span id="cb46-48"><a href="#cb46-48"></a> cor_matrix =<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>,  m <span class="op">*</span><span class="st"> </span>t,  m <span class="op">*</span><span class="st"> </span>t)</span>
<span id="cb46-49"><a href="#cb46-49"></a> useage_m =<span class="st"> </span><span class="kw">cumsum</span>(m <span class="op">*</span><span class="st"> </span>t); useage_m =<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, useage_m)</span>
<span id="cb46-50"><a href="#cb46-50"></a></span>
<span id="cb46-51"><a href="#cb46-51"></a> <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(m <span class="op">*</span><span class="st"> </span>t)){i_reg =<span class="st"> </span><span class="kw">region_ij</span>(useage_m, i)</span>
<span id="cb46-52"><a href="#cb46-52"></a>      <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(m <span class="op">*</span><span class="st"> </span>t)){j_reg =<span class="st"> </span><span class="kw">region_ij</span>(useage_m, j)</span>
<span id="cb46-53"><a href="#cb46-53"></a>          <span class="cf">if</span>(i_reg <span class="op">==</span><span class="st"> </span>j_reg <span class="op">&amp;</span><span class="st"> </span>i <span class="op">!=</span><span class="st"> </span>j){</span>
<span id="cb46-54"><a href="#cb46-54"></a>              cor_matrix[i, j] =<span class="st"> </span>alpha0}<span class="cf">else</span> <span class="cf">if</span>(i <span class="op">==</span><span class="st"> </span>j){cor_matrix[i, j] =<span class="st"> </span><span class="dv">1</span></span>
<span id="cb46-55"><a href="#cb46-55"></a> }<span class="cf">else</span> <span class="cf">if</span>(i_reg <span class="op">!=</span><span class="st"> </span>j_reg){cor_matrix[i,j] =<span class="st"> </span>alpha0 <span class="op">*</span><span class="st"> </span>(rho<span class="op">^</span>(<span class="kw">abs</span>(i_reg <span class="op">-</span><span class="st"> </span>j_reg)))}}}</span>
<span id="cb46-56"><a href="#cb46-56"></a></span>
<span id="cb46-57"><a href="#cb46-57"></a>Sigma[[<span class="dv">1</span>]] =<span class="st"> </span>cor_matrix; Sigma[[<span class="dv">2</span>]] =<span class="st"> </span>cor_matrix</span>
<span id="cb46-58"><a href="#cb46-58"></a></span>
<span id="cb46-59"><a href="#cb46-59"></a>y_ed =<span class="st"> </span><span class="kw">simbinPROBIT</span>(<span class="dt">mu =</span> mu, <span class="dt">Sigma =</span> Sigma, <span class="dt">n =</span> n)</span></code></pre></div>
</div>
<div id="simbinclf-example-generating-correlated-binary-data-using-the-conditional-linear-family-method" class="section level2">
<h2><code>simbinCLF()</code> example: generating correlated binary data using the conditional linear family method</h2>
<p>The <code>simbinCLF()</code> function generates correlated binary data using the conditional linear family method <span class="citation">(Qaqish 2003)</span>. It simulates a vector of binary outcomes according the specified marginal mean vector and correlation structure. Natural constraints and compatibility between the marginal mean and correlation matrix are checked.</p>
<p>We use the <code>simbinCLF()</code> function to generate correlated binary data with different correlation structures. We consider simulating a cross-sectional SW-CRT dataset with 2 clusters, 3 periods with the same cluster-period size of 5. We use two mean vectors for the two clusters and specify the <code>mu</code> argument.</p>
<p>For the exchangeable correlation structure, we specify both the within-period and inter-period correlation parameters to be <code>0.015</code>. We use <code>0.03</code> and <code>0.015</code> for the within-period and inter-period correlations, respectively. The exponential decay correlation structure has an decay parameter <code>0.8</code> with the within-period correlation parameter <code>0.03</code>.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="co">##### Simulate 2 clusters, 3 periods and cluster-period size of 5</span></span>
<span id="cb47-2"><a href="#cb47-2"></a></span>
<span id="cb47-3"><a href="#cb47-3"></a>t =<span class="st"> </span><span class="dv">3</span>; n =<span class="st"> </span><span class="dv">2</span>; m =<span class="st"> </span><span class="dv">5</span></span>
<span id="cb47-4"><a href="#cb47-4"></a> </span>
<span id="cb47-5"><a href="#cb47-5"></a><span class="co"># means of cluster 1</span></span>
<span id="cb47-6"><a href="#cb47-6"></a>u_c1 =<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.4</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span>)</span>
<span id="cb47-7"><a href="#cb47-7"></a>u1 &lt;-<span class="st"> </span><span class="kw">rep</span>(u_c1, <span class="kw">c</span>(<span class="kw">rep</span>(m, t)))</span>
<span id="cb47-8"><a href="#cb47-8"></a><span class="co"># means of cluster 2</span></span>
<span id="cb47-9"><a href="#cb47-9"></a>u_c2 =<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.35</span>, <span class="fl">0.25</span>, <span class="fl">0.2</span>)</span>
<span id="cb47-10"><a href="#cb47-10"></a>u2 &lt;-<span class="st"> </span><span class="kw">rep</span>(u_c2, <span class="kw">c</span>(<span class="kw">rep</span>(m, t)))</span>
<span id="cb47-11"><a href="#cb47-11"></a></span>
<span id="cb47-12"><a href="#cb47-12"></a><span class="co"># List of mean vectors</span></span>
<span id="cb47-13"><a href="#cb47-13"></a>mu =<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb47-14"><a href="#cb47-14"></a>mu[[<span class="dv">1</span>]] =<span class="st"> </span>u1; mu[[<span class="dv">2</span>]] =<span class="st"> </span>u2;</span>
<span id="cb47-15"><a href="#cb47-15"></a></span>
<span id="cb47-16"><a href="#cb47-16"></a><span class="co"># List of correlation matrices</span></span>
<span id="cb47-17"><a href="#cb47-17"></a> </span>
<span id="cb47-18"><a href="#cb47-18"></a><span class="co">## correlation parameters</span></span>
<span id="cb47-19"><a href="#cb47-19"></a>alpha0 =<span class="st"> </span><span class="fl">0.03</span>; alpha1 =<span class="st"> </span><span class="fl">0.015</span>; rho =<span class="st"> </span><span class="fl">0.8</span></span>
<span id="cb47-20"><a href="#cb47-20"></a></span>
<span id="cb47-21"><a href="#cb47-21"></a><span class="co">## (1) exchangeable</span></span>
<span id="cb47-22"><a href="#cb47-22"></a>Sigma =<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb47-23"><a href="#cb47-23"></a>Sigma[[<span class="dv">1</span>]] =<span class="st"> </span><span class="kw">diag</span>(m <span class="op">*</span><span class="st"> </span>t) <span class="op">*</span><span class="st"> </span>( <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>alpha1) <span class="op">+</span><span class="st"> </span><span class="kw">matrix</span>(alpha1, m <span class="op">*</span><span class="st"> </span>t,  m <span class="op">*</span><span class="st"> </span>t )</span>
<span id="cb47-24"><a href="#cb47-24"></a>Sigma[[<span class="dv">2</span>]] =<span class="st"> </span><span class="kw">diag</span>(m <span class="op">*</span><span class="st"> </span>t) <span class="op">*</span><span class="st"> </span>( <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>alpha1) <span class="op">+</span><span class="st"> </span><span class="kw">matrix</span>(alpha1, m <span class="op">*</span><span class="st"> </span>t,  m <span class="op">*</span><span class="st"> </span>t )</span>
<span id="cb47-25"><a href="#cb47-25"></a>y_exc =<span class="st"> </span><span class="kw">simbinCLF</span>(<span class="dt">mu =</span> mu, <span class="dt">Sigma =</span> Sigma, <span class="dt">n =</span> n)</span>
<span id="cb47-26"><a href="#cb47-26"></a></span>
<span id="cb47-27"><a href="#cb47-27"></a><span class="co">## (2) nested exchangeable</span></span>
<span id="cb47-28"><a href="#cb47-28"></a>Sigma =<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb47-29"><a href="#cb47-29"></a>cor_matrix =<span class="st"> </span><span class="kw">matrix</span>(alpha1, m <span class="op">*</span><span class="st"> </span>t,  m <span class="op">*</span><span class="st"> </span>t)</span>
<span id="cb47-30"><a href="#cb47-30"></a>loc1 =<span class="st"> </span><span class="dv">0</span>; loc2 =<span class="st"> </span><span class="dv">0</span></span>
<span id="cb47-31"><a href="#cb47-31"></a><span class="cf">for</span>(t <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>t){loc1 =<span class="st"> </span>loc2 <span class="op">+</span><span class="st"> </span><span class="dv">1</span>; loc2 =<span class="st"> </span>loc1 <span class="op">+</span><span class="st"> </span>m <span class="op">-</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb47-32"><a href="#cb47-32"></a>    <span class="cf">for</span>(i <span class="cf">in</span> loc1<span class="op">:</span>loc2){<span class="cf">for</span>(j <span class="cf">in</span> loc1<span class="op">:</span>loc2){</span>
<span id="cb47-33"><a href="#cb47-33"></a>         <span class="cf">if</span>(i <span class="op">!=</span><span class="st"> </span>j){cor_matrix[i, j] =<span class="st"> </span>alpha0}<span class="cf">else</span>{cor_matrix[i, j] =<span class="st"> </span><span class="dv">1</span>}}}}</span>
<span id="cb47-34"><a href="#cb47-34"></a> </span>
<span id="cb47-35"><a href="#cb47-35"></a>Sigma[[<span class="dv">1</span>]] =<span class="st"> </span>cor_matrix; Sigma[[<span class="dv">2</span>]] =<span class="st"> </span>cor_matrix</span>
<span id="cb47-36"><a href="#cb47-36"></a>y_nex =<span class="st"> </span><span class="kw">simbinCLF</span>(<span class="dt">mu =</span> mu, <span class="dt">Sigma =</span> Sigma, <span class="dt">n =</span> n)</span>
<span id="cb47-37"><a href="#cb47-37"></a></span>
<span id="cb47-38"><a href="#cb47-38"></a><span class="co">## (3) exponential decay</span></span>
<span id="cb47-39"><a href="#cb47-39"></a> </span>
<span id="cb47-40"><a href="#cb47-40"></a>Sigma =<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb47-41"><a href="#cb47-41"></a></span>
<span id="cb47-42"><a href="#cb47-42"></a><span class="co">### function to find the period of the ith index</span></span>
<span id="cb47-43"><a href="#cb47-43"></a>region_ij&lt;-<span class="cf">function</span>(points, i){diff =<span class="st"> </span>i <span class="op">-</span><span class="st"> </span>points</span>
<span id="cb47-44"><a href="#cb47-44"></a>     <span class="cf">for</span>(h <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(<span class="kw">length</span>(diff) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)){<span class="cf">if</span>(diff[h] <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>diff[h <span class="op">+</span><span class="st"> </span><span class="dv">1</span>] <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>){find &lt;-<span class="st"> </span>h}}</span>
<span id="cb47-45"><a href="#cb47-45"></a>  <span class="kw">return</span>(find)}</span>
<span id="cb47-46"><a href="#cb47-46"></a></span>
<span id="cb47-47"><a href="#cb47-47"></a>cor_matrix =<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>,  m <span class="op">*</span><span class="st"> </span>t,  m <span class="op">*</span><span class="st"> </span>t)</span>
<span id="cb47-48"><a href="#cb47-48"></a>useage_m =<span class="st"> </span><span class="kw">cumsum</span>(m <span class="op">*</span><span class="st"> </span>t); useage_m =<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, useage_m)</span>
<span id="cb47-49"><a href="#cb47-49"></a></span>
<span id="cb47-50"><a href="#cb47-50"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(m <span class="op">*</span><span class="st"> </span>t)){i_reg =<span class="st"> </span><span class="kw">region_ij</span>(useage_m, i)</span>
<span id="cb47-51"><a href="#cb47-51"></a>      <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(m <span class="op">*</span><span class="st"> </span>t)){j_reg =<span class="st"> </span><span class="kw">region_ij</span>(useage_m, j)</span>
<span id="cb47-52"><a href="#cb47-52"></a>          <span class="cf">if</span>(i_reg <span class="op">==</span><span class="st"> </span>j_reg <span class="op">&amp;</span><span class="st"> </span>i <span class="op">!=</span><span class="st"> </span>j){</span>
<span id="cb47-53"><a href="#cb47-53"></a>              cor_matrix[i, j] =<span class="st"> </span>alpha0}<span class="cf">else</span> <span class="cf">if</span>(i <span class="op">==</span><span class="st"> </span>j){cor_matrix[i, j] =<span class="st"> </span><span class="dv">1</span></span>
<span id="cb47-54"><a href="#cb47-54"></a> }<span class="cf">else</span> <span class="cf">if</span>(i_reg <span class="op">!=</span><span class="st"> </span>j_reg){cor_matrix[i,j] =<span class="st"> </span>alpha0 <span class="op">*</span><span class="st"> </span>(rho<span class="op">^</span>(<span class="kw">abs</span>(i_reg <span class="op">-</span><span class="st"> </span>j_reg)))}}}</span>
<span id="cb47-55"><a href="#cb47-55"></a></span>
<span id="cb47-56"><a href="#cb47-56"></a>Sigma[[<span class="dv">1</span>]] =<span class="st"> </span>cor_matrix; Sigma[[<span class="dv">2</span>]] =<span class="st"> </span>cor_matrix</span>
<span id="cb47-57"><a href="#cb47-57"></a></span>
<span id="cb47-58"><a href="#cb47-58"></a>y_ed =<span class="st"> </span><span class="kw">simbinCLF</span>(<span class="dt">mu =</span> mu, <span class="dt">Sigma =</span> Sigma, <span class="dt">n =</span> n)</span></code></pre></div>
</div>
<div id="session-information" class="section level1">
<h1>Session Information</h1>
<pre><code>## R version 4.0.3 (2020-10-10)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Big Sur 10.16
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] C/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] geeCRT_0.1.0
## 
## loaded via a namespace (and not attached):
##  [1] mvtnorm_1.1-1     digest_0.6.27     MASS_7.3-53       magrittr_2.0.1    evaluate_0.14    
##  [6] rootSolve_1.8.2.1 highr_0.8         rlang_0.4.10      stringi_1.5.3     rmarkdown_2.7    
## [11] tools_4.0.3       stringr_1.4.0     xfun_0.22         yaml_2.2.1        compiler_4.0.3   
## [16] htmltools_0.5.1.1 knitr_1.31</code></pre>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-emrich1991method">
<p>Emrich, Lawrence J, and Marion R Piedmonte. 1991. “A Method for Generating High-Dimensional Multivariate Binary Variates.” <em>The American Statistician</em> 45 (4): 302–4.</p>
</div>
<div id="ref-li2018sample">
<p>Li, Fan, Elizabeth L Turner, and John S Preisser. 2018. “Sample Size Determination for Gee Analyses of Stepped Wedge Cluster Randomized Trials.” <em>Biometrics</em> 74 (4): 1450–8.</p>
</div>
<div id="ref-kxaa056">
<p>Li, Fan, Hengshi Yu, Paul J Rathouz, Elizabeth L Turner, and John S Preisser. 2021. “Marginal modeling of cluster-period means and intraclass correlations in stepped wedge designs with binary outcomes.” <em>Biostatistics</em>, February. <a href="https://doi.org/10.1093/biostatistics/kxaa056">https://doi.org/10.1093/biostatistics/kxaa056</a>.</p>
</div>
<div id="ref-preisser2008finite">
<p>Preisser, John S, Bing Lu, and Bahjat F Qaqish. 2008. “Finite Sample Adjustments in Estimating Equations and Covariance Estimators for Intracluster Correlations.” <em>Statistics in Medicine</em> 27 (27): 5764–85.</p>
</div>
<div id="ref-qaqish2003family">
<p>Qaqish, Bahjat F. 2003. “A Family of Multivariate Binary Distributions for Simulating Correlated Binary Variables with Specified Marginal Means and Correlations.” <em>Biometrika</em> 90 (2): 455–63.</p>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
